!function(e,t){e.module("dynform",["dynaform.controls.input","dynaform.controls.list","dynaform.lib.file-reader","dynaform.config","dynaform.elements"]).controller("DynamicFormCtrl",["$scope","$element","$attrs","$q","$parse","$http","$templateCache","$compile","$timeout","dynaformElements","$log",function(t,n,a,i,r,l,d,o,s,p,u){function m(){return u.debug("Template found in attributes:",y.template),i.when(r(y.template)(t))}function f(){return u.debug("loading template...",y.templateUrl),l.get(y.templateUrl,{cache:d}).then(function(e){return u.debug("Template loaded:",e.data),e.data})}function c(t){var n=e.isDefined(t.ngModel),a=e.isDefined(t.template)||e.isDefined(t.templateUrl),i=!g.hasClass("dynamic-form");return n||u.error("Dynamic form does not have ng-model defined. Attributes:",t),a||u.error("Dynamic form does not template or templateUrl defined. Attributes:",t),i||u.error("Dynamic form already has dynamic-form css class. Attributes:",t),n&&a&&i}var y=a,g=n,b=null,h=null;if(c(y)){var v=y.template?m:f;h=r(y.ngModel)(t),v().then(function(n){function a(n,a){function i(n,a){t.$apply(function(){t[a]={}}),t.$apply(function(){t[a]=e.copy(n.data("$_cleanModel"))})}n.bind("reset",function(){s(function(){t.$broadcast("reset",arguments)},0)}),t.$on("reset",function(){i(n,a.ngModel)})}function i(e,n){o(n)(t),e.replaceWith(n)}b=p.parseTemplate(n,g,h,y),b=p.prepareNewElement(b,g,h),a(b,y),i(g,b)})}}]).directive("dynamicForm",function(){return{restrict:"E",controller:"DynamicFormCtrl"}}),e.module("dynaform.config",[]).service("formSupportedElements",function(){var t=this;this.getType=function(e){return t.elements[e]},this.getRootElementMarkup=function(e){return"<"+e+"></"+e+">"},this.getElementForType=function(n){var a=t.getType(n),i=e.element(t.getRootElementMarkup(a.element));return e.isDefined(a.type)&&i.attr("type",a.type),i},this.isSupported=function(n){var a=e.isDefined(t.getType(n)),i=t.elements[n]!==!1;return a&&i},this.isEditable=function(n){var a=t.getType(n);return e.isDefined(a.editable)&&a.editable},this.renderBlankForUnsupportedType=function(t,n,a){return n=e.element("<span></span>"),e.isDefined(t.label)&&e.element(n).html(t.label),e.forEach(t,function(e,t){["label","type"].indexOf(t)>-1||n.attr(t,e)}),a.append(n),n=null},this.elements={text:{element:"input",type:"text",editable:!0,textBased:!0},date:{element:"input",type:"date",editable:!0,textBased:!0},datetime:{element:"input",type:"datetime",editable:!0,textBased:!0},"datetime-local":{element:"input",type:"datetime-local",editable:!0,textBased:!0},email:{element:"input",type:"email",editable:!0,textBased:!0},month:{element:"input",type:"month",editable:!0,textBased:!0},number:{element:"input",type:"number",editable:!0,textBased:!0},password:{element:"input",type:"password",editable:!0,textBased:!0},search:{element:"input",type:"search",editable:!0,textBased:!0},tel:{element:"input",type:"tel",editable:!0,textBased:!0},textarea:{element:"textarea",editable:!0,textBased:!0},time:{element:"input",type:"time",editable:!0,textBased:!0},url:{element:"input",type:"url",editable:!0,textBased:!0},week:{element:"input",type:"week",editable:!0,textBased:!0},checkbox:{element:"input",type:"checkbox",editable:!0,textBased:!1},color:{element:"input",type:"color",editable:!0,textBased:!1},file:{element:"input",type:"file",editable:!0,textBased:!1},range:{element:"input",type:"range",editable:!0,textBased:!1},select:{element:"select",editable:!0,textBased:!1},checklist:{element:"div",editable:!1,textBased:!1},radio:{element:"div",editable:!1,textBased:!1},button:{element:"button",type:"button",editable:!1,textBased:!1},hidden:{element:"input",type:"hidden",editable:!1,textBased:!1},image:{element:"input",type:"image",editable:!1,textBased:!1},legend:{element:"legend",editable:!1,textBased:!1},reset:{element:"button",type:"reset",editable:!1,textBased:!1},submit:{element:"button",type:"submit",editable:!1,textBased:!1}}}),e.module("dynaform.controls.input",[]).directive("input",["$parse",function(e){return{restrict:"E",require:"?ngModel",link:function(t,n,a,i){if("file"===a.type){var r=e(a.ngModel),l=r.assign,d=e(a.onChange),o=function(){t.$apply(function(){l(t,n[0].files),d(t)})};i.$render=function(){n[0].files=this.$viewValue},n.bind("change",o)}else"range"===a.type&&i.$parsers.push(function(e){return e?parseFloat(e):void 0})}}}]),e.module("dynaform.controls.list",[]).directive("ngList",function(){return{require:"?ngModel",link:function(n,a,i,r){var l=/\/(.*)\//.exec(a.attr(i.$attr.ngList)),d=l&&new RegExp(l[1])||a.attr(i.$attr.ngList)||",";(null===a[0].form||e.element(a[0].form).hasClass("dynamic-form"))&&(r.$parsers.splice(0,1),r.$formatters.splice(0,1),r.$parsers.push(function(t){var n=[];return e.isString(t)&&(String.prototype.trim?e.forEach(t.split(d),function(e){e&&n.push(e.trim())}):e.forEach(t.split(d),function(e){e&&n.push(e.replace(/^\s*/,"").replace(/\s*$/,""))})),n}),r.$formatters.push(function(n){var a=e.isString(d)&&d||", ";return e.isArray(n)?n.join(a):t}))}}}),e.module("dynaform.elements",["dynaform.elements.text","dynaform.config"]).service("dynaformElements",["parseTextElement","formSupportedElements","$document","$log",function(t,n,a){var i=this;i.parseTemplate=function(t,r,l,d){function o(){return!e.equals(f.parent(),a)}function s(){return!e.equals(f.parent(),e.element())}function p(t){var n=t.parent()[0];return d.$normalize(e.lowercase(n.nodeName))}function u(e){return["form","ngForm","dynamicForm"].indexOf(p(e))>-1}var m,f=r,c=!1;for(e.forEach(t,function(t,a){n.isSupported(t.type)?(e.isDefined(t.model)||(t.model=a),m=i.parseField(t,l,d),r.append(m),m=null):m=n.renderBlankForUnsupportedType(t,m,r)});o()&&s();){if(u(f)){c=!0;break}f=f.parent()}return m=e.element(c?"<ng-form></ng-form>":"<form></form>")},i.prepareNewElement=function(t,n,a){function i(t,n){e.forEach(n.$attr,function(e,a){t.attr(e,n[a])}),t.attr("model",n.ngModel),t.removeAttr("ng-model")}function r(t,n){e.forEach(t.classList,function(e){n.classList.add(e)})}function l(t,n,a){t.addClass("dynamic-form"),t.append(n.contents()),t.data("$_cleanModel",e.copy(a))}return i(t,attrs),r(n[0],t[0]),l(t,n,a),t},i.parseField=function(a,r,l){var d=null,o={},s="",p=n.getElementForType(a.type);return p=i.parseEditableElements(a,p,l),p=t(a,p),"number"===a.type||"range"===a.type?(e.isDefined(a.minValue)&&p.attr("min",a.minValue),e.isDefined(a.maxValue)&&p.attr("max",a.maxValue),"range"===a.type&&e.isDefined(a.step)&&p.attr("step",a.step)):["text","textarea"].indexOf(a.type)>-1?e.isDefined(a.splitBy)&&p.attr("ng-list",a.splitBy):"checkbox"===a.type?(e.isDefined(a.isOn)&&p.attr("ng-true-value",a.isOn),e.isDefined(a.isOff)&&p.attr("ng-false-value",a.isOff),e.isDefined(a.slaveTo)&&p.attr("ng-checked",a.slaveTo)):"checklist"===a.type?(e.isDefined(a.val)&&(r[a.model]=e.copy(a.val)),e.isDefined(a.options)&&(e.isDefined(r[a.model])&&e.isObject(r[a.model])||(r[a.model]={}),e.forEach(a.options,function(t,n){d=e.element('<input type="checkbox" />'),d.attr("name",a.model+"."+n),d.attr("ng-model",l.ngModel+"['"+a.model+"']['"+n+"']"),e.isDefined(t["class"])&&d.attr("ng-class",t["class"]),e.isDefined(a.disabled)&&d.attr("ng-disabled",a.disabled),e.isDefined(a.readonly)&&d.attr("ng-readonly",a.readonly),e.isDefined(a.required)&&d.attr("ng-required",a.required),e.isDefined(a.callback)&&d.attr("ng-change",a.callback),e.isDefined(t.isOn)&&d.attr("ng-true-value",t.isOn),e.isDefined(t.isOff)&&d.attr("ng-false-value",t.isOff),e.isDefined(t.slaveTo)&&d.attr("ng-checked",t.slaveTo),e.isDefined(t.val)&&(r[a.model][n]=e.copy(t.val),newChlid.attr("value",a.val)),e.isDefined(t.label)&&(d=d.wrap("<label></label>").parent(),d.append(document.createTextNode(" "+t.label))),p.append(d)}))):"radio"===a.type?(e.isDefined(a.val)&&(r[a.model]=e.copy(a.val)),e.isDefined(a.values)&&e.forEach(a.values,function(t,n){d=e.element('<input type="radio" />'),d.attr("name",a.model),d.attr("ng-model",l.ngModel+"['"+a.model+"']"),e.isDefined(a["class"])&&d.attr("ng-class",a["class"]),e.isDefined(a.disabled)&&d.attr("ng-disabled",a.disabled),e.isDefined(a.callback)&&d.attr("ng-change",a.callback),e.isDefined(a.readonly)&&d.attr("ng-readonly",a.readonly),e.isDefined(a.required)&&d.attr("ng-required",a.required),d.attr("value",n),e.isDefined(a.val)&&a.val===n&&d.attr("checked","checked"),t&&(d=d.wrap("<label></label>").parent(),d.append(document.createTextNode(" "+t))),p.append(d)})):"select"===a.type?(e.isDefined(a.multiple)&&a.multiple!==!1&&p.attr("multiple","multiple"),e.isDefined(a.empty)&&a.empty!==!1&&p.append(e.element('<option value=""></option>').html(a.empty)),e.isDefined(a.autoOptions)?p.attr("ng-options",a.autoOptions):e.isDefined(a.options)&&(e.forEach(a.options,function(t,n){d=e.element("<option></option>"),d.attr("value",n),e.isDefined(t.disabled)&&d.attr("ng-disabled",t.disabled),e.isDefined(t.slaveTo)&&d.attr("ng-selected",t.slaveTo),e.isDefined(t.label)&&d.html(t.label),e.isDefined(t.group)?(e.isDefined(o[t.group])||(o[t.group]=e.element("<optgroup></optgroup>"),o[t.group].attr("label",t.group)),o[t.group].append(d)):p.append(d)}),e.equals(o,{})||(e.forEach(o,function(e){p.append(e)}),o={}))):"image"===a.type?(e.isDefined(a.label)&&p.attr("alt",a.label),e.isDefined(a.source)&&p.attr("src",a.source)):"hidden"===a.type?(p.attr("name",a.model),p.attr("ng-model",l.ngModel+"['"+a.model+"']"),e.isDefined(a.val)&&(r[a.model]=e.copy(a.val),p.attr("value",a.val))):"file"===a.type&&e.isDefined(a.multiple)&&p.attr("multiple",a.multiple),"radio"!==a.type&&(e.isDefined(a["class"])&&p.attr("ng-class",a["class"]),"checklist"!==a.type&&(e.isDefined(a.disabled)&&p.attr("ng-disabled",a.disabled),e.isDefined(a.callback)&&(s=["button","image","legend","reset","submit"].indexOf(a.type)>-1?"ng-click":"ng-change",p.attr(s,a.callback)))),e.isDefined(a.label)&&(["image","hidden"].indexOf(a.type)>-1?e.noop():["button","legend","reset","submit"].indexOf(a.type)>-1?p.html(a.label):(p=p.wrap("<label></label>").parent(),p.prepend(document.createTextNode(a.label+" ")))),p},i.parseEditableElements=function(t,a,i){var r=t.type,l=t.model,d=t.required,o=t.readonly,s=t.val;return n.isEditable(r)&&(a.attr("name",l),a.attr("ng-model",i.ngModel+"['"+l+"']"),e.isDefined(o)&&a.attr("ng-readonly",o),e.isDefined(d)&&a.attr("ng-required",d),e.isDefined(s)&&(l[l]=e.copy(s),a.attr("value",s))),a}}]),e.module("dynaform.elements.text",["dynaform.config"]).factory("parseTextElement",["formSupportedElements",function(t){var n=t.elements;return function(t,a){return e.isDefined(n[t.type].textBased)&&n[t.type].textBased&&(e.isDefined(t.minLength)&&a.attr("ng-minlength",t.minLength),e.isDefined(t.maxLength)&&a.attr("ng-maxlength",t.maxLength),e.isDefined(t.validate)&&a.attr("ng-pattern",t.validate),e.isDefined(t.placeholder)&&a.attr("placeholder",t.placeholder)),["text","textarea"].indexOf(t.type)>-1&&e.isDefined(t.splitBy)&&a.attr("ng-list",t.splitBy),a}}]),e.module("dynaform.lib.file-reader",[]).factory("fileReader",["$q",function(e){var t=function(e,t,n){return function(){n.$apply(function(){t.resolve(e.result)})}},n=function(e,t,n){return function(){n.$apply(function(){t.reject(e.error)})}},a=function(e,t){return function(n){t.$broadcast("fileProgress",{total:n.total,loaded:n.loaded,status:e.readyState})}},i=function(e,i){var r=new FileReader;return r.onload=t(r,e,i),r.onerror=n(r,e,i),r.onprogress=a(r,i),r};return{readAsArrayBuffer:function(t,n){var a=e.defer(),r=i(a,n);return r.readAsArrayBuffer(t),a.promise},readAsBinaryString:function(t,n){var a=e.defer(),r=i(a,n);return r.readAsBinaryString(t),a.promise},readAsDataURL:function(t,n){var a=e.defer(),r=i(a,n);return r.readAsDataURL(t),a.promise},readAsText:function(t,n){var a=e.defer(),r=i(a,n);return r.readAsText(t),a.promise}}}])}(angular,void 0);